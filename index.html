<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Stellar Pro - Settings Area</title>
    <style>
        :root {
            --space-black: #050508;
            --star-cyan: #00f2ff;
            --glass: rgba(12, 12, 20, 0.98);
            --accent: #00f2ff;
            --grid-opacity: 0.1;
        }

        body.mode-black { --space-black: #000; --accent: #666; --star-cyan: #fff; }
        body.mode-grid { --space-black: #050510; --accent: #ff9f43; --star-cyan: #ff9f43; }

        body { margin: 0; overflow: hidden; background: #000; font-family: 'Segoe UI', sans-serif; touch-action: none; color: #fff; }

        /* Interface Principal */
        #crosshair { position: fixed; top: 50%; left: 50%; width: 20px; height: 20px; border: 1px solid var(--star-cyan); transform: translate(-50%, -50%); pointer-events: none; z-index: 50; border-radius: 50%; opacity: 0.4; }
        #btn-mark { position: fixed; bottom: 20px; right: 20px; width: 70px; height: 70px; background: var(--star-cyan); color: #000; border: none; border-radius: 50%; font-weight: bold; z-index: 100; font-size: 30px; box-shadow: 0 0 20px rgba(0,242,255,0.4); }
        
        #menu-toggle { position: fixed; top: 20px; left: 20px; width: 50px; height: 50px; background: var(--glass); color: var(--star-cyan); border-radius: 10px; border: 1px solid var(--star-cyan); z-index: 999; }
        #settings-toggle { position: fixed; top: 20px; right: 20px; width: 50px; height: 50px; background: var(--glass); color: var(--star-cyan); border-radius: 10px; border: 1px solid var(--star-cyan); z-index: 999; font-size: 20px; }

        /* Área Específica de Configurações */
        #settings-area {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--space-black); z-index: 2000;
            transform: translateY(100%); transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            padding: 30px; box-sizing: border-box; overflow-y: auto;
        }
        #settings-area.active { transform: translateY(0); }

        /* Sidebar de Navegação */
        #sidebar { position: fixed; left: 0; top: 0; width: 280px; height: 100vh; background: var(--glass); padding: 20px; z-index: 1000; transform: translateX(-100%); transition: 0.3s; border-right: 1px solid rgba(255,255,255,0.1); }
        #sidebar.active { transform: translateX(0); }

        .config-section { background: rgba(255,255,255,0.05); padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.1); }
        h2, h3 { color: var(--star-cyan); margin-top: 0; }
        
        button.action-btn { width: 100%; padding: 15px; margin-bottom: 10px; background: transparent; border: 1px solid var(--accent); color: var(--accent); border-radius: 8px; font-weight: bold; text-transform: uppercase; font-size: 12px; }
        button.action-btn:active { background: var(--accent); color: #000; }

        #overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 998; display: none; }
        canvas { display: block; }
    </style>
</head>
<body class="mode-stellar">

<div id="crosshair"></div>
<button id="menu-toggle" onclick="toggleSidebar()">☰</button>
<button id="settings-toggle" onclick="toggleSettings()">⚙</button>
<button id="btn-mark" onclick="markCenterPoint()">+</button>
<div id="overlay" onclick="closeAll()"></div>

<div id="sidebar">
    <h2>SETORES</h2>
    <div id="map-list" style="overflow-y:auto; flex-grow:1;"></div>
    <button class="action-btn" onclick="openModal('map')" style="margin-top: 20px;">+ NOVO SETOR</button>
</div>

<div id="settings-area">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
        <h2>CONFIGURAÇÕES</h2>
        <button onclick="toggleSettings()" style="background:none; border:none; color:#ff4757; font-size: 24px;">✕</button>
    </div>

    <div class="config-section">
        <h3>APARÊNCIA</h3>
        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;">
            <button class="action-btn" onclick="setTheme('stellar')">NEON</button>
            <button class="action-btn" onclick="setTheme('black')">DARK</button>
            <button class="action-btn" onclick="setTheme('grid')">GRID</button>
        </div>
        <div style="margin-top: 15px;">
            <label style="font-size: 12px; opacity: 0.6;">OPACIDADE DA GRADE</label>
            <input type="range" min="0" max="100" value="10" oninput="updateGridOpacity(this.value)" style="width:100%; margin-top:10px;">
        </div>
    </div>

    <div class="config-section">
        <h3>CÂMERA</h3>
        <button class="action-btn" onclick="resetCamera(); toggleSettings();">CENTRALIZAR VISÃO</button>
    </div>

    <div class="config-section">
        <h3>DADOS E BACKUP</h3>
        <button class="action-btn" onclick="exportData()" style="border-color: #4cd137; color: #4cd137;">EXPORTAR JSON</button>
        <button class="action-btn" onclick="document.getElementById('fileInput').click()" style="border-color: #0097e6; color: #0097e6;">IMPORTAR JSON</button>
        <input type="file" id="fileInput" style="display:none" onchange="importData(event)">
        <button class="action-btn" onclick="clearAllData()" style="border-color: #ff4757; color: #ff4757; margin-top: 10px;">RESETAR TUDO</button>
    </div>
    
    <p style="text-align: center; opacity: 0.3; font-size: 10px;">STELLAR PRO V2.0 - 2026</p>
</div>

<div id="custom-modal" style="position:fixed; top:20%; left:50%; transform:translateX(-50%); background:#111; padding:25px; border:1px solid var(--star-cyan); z-index:3000; display:none; width:85%; border-radius:12px;">
    <h3 id="modal-title">NOMEAR</h3>
    <input type="text" id="modal-input" style="width:100%; padding:15px; background:#000; border:1px solid #333; color:#fff; margin-bottom:15px; border-radius:8px;">
    <div style="display:flex; gap:10px;">
        <button class="action-btn" onclick="confirmModal()" style="background:var(--star-cyan); color:#000; flex:1">SALVAR</button>
        <button class="action-btn" onclick="closeModal()" style="border:none; flex:1">VOLTAR</button>
    </div>
</div>

<canvas id="canvas"></canvas>

<script>
// O código JavaScript permanece a mesma lógica robusta anterior, 
// apenas com as funções de toggle de telas ajustadas.

const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const sidebar = document.getElementById('sidebar');
const settingsArea = document.getElementById('settings-area');
const modal = document.getElementById('custom-modal');
const overlay = document.getElementById('overlay');
const modalInput = document.getElementById('modal-input');

const DB_KEY = 'stellar_mobile_split_v1';
let maps = JSON.parse(localStorage.getItem(DB_KEY)) || {}; 
let currentMapName = localStorage.getItem('last_map_split') || null;
let points = (currentMapName && maps[currentMapName]) ? [...maps[currentMapName]] : [];
let camera = { x: 0, y: 0, zoom: 1 };
let currentTheme = 'stellar';
let gridOpacity = 0.1;

// Touch Control
let isDragging = false;
let lastTouchPos = { x: 0, y: 0 };
let initialPinchDist = null;
let initialZoom = 1;

function setupCanvas() {
    const dpr = window.devicePixelRatio || 1;
    canvas.width = window.innerWidth * dpr;
    canvas.height = window.innerHeight * dpr;
    ctx.scale(dpr, dpr);
    canvas.style.width = window.innerWidth + 'px';
    canvas.style.height = window.innerHeight + 'px';
}

function toggleSidebar() { sidebar.classList.toggle('active'); overlay.style.display = sidebar.classList.contains('active') ? 'block' : 'none'; }
function toggleSettings() { settingsArea.classList.toggle('active'); }
function closeAll() { sidebar.classList.remove('active'); modal.style.display = 'none'; overlay.style.display = 'none'; }

function resetCamera() { camera = { x: 0, y: 0, zoom: 1 }; }
function setTheme(t) { document.body.className = 'mode-' + t; currentTheme = t; }
function updateGridOpacity(v) { gridOpacity = v / 100; }

function openModal(type) { 
    currentModalType = type; 
    modal.style.display = 'block'; 
    overlay.style.display = 'block';
    modalInput.focus();
}
function closeModal() { modal.style.display = 'none'; if(!sidebar.classList.contains('active')) overlay.style.display = 'none'; }

function confirmModal() {
    const val = modalInput.value.trim();
    if (currentModalType === 'map' && val) { maps[val] = []; switchMap(val); }
    else if (currentModalType === 'point' && pendingPointData) {
        points.push({ ...pendingPointData, label: val || `P-${points.length + 1}` });
        saveCurrentMap();
    }
    closeAll();
    modalInput.value = "";
}

function markCenterPoint() {
    if(!currentMapName) return alert("Crie um setor!");
    pendingPointData = { x: -camera.x, y: -camera.y };
    openModal('point');
}

function switchMap(name) { currentMapName = name; points = [...maps[name]]; localStorage.setItem('last_map_split', name); renderMapList(); }
function saveCurrentMap() { if(currentMapName) { maps[currentMapName] = points; localStorage.setItem(DB_KEY, JSON.stringify(maps)); } }
function renderMapList() {
    const list = document.getElementById('map-list');
    list.innerHTML = '';
    Object.keys(maps).forEach(name => {
        const div = document.createElement('div');
        div.style = `padding:15px; background:rgba(255,255,255,0.05); margin-bottom:5px; border-radius:8px; display:flex; justify-content:space-between; ${name === currentMapName ? 'border:1px solid var(--star-cyan)' : ''}`;
        div.innerHTML = `<span>${name}</span> <span onclick="deleteMap('${name}', event)">✖</span>`;
        div.onclick = () => { switchMap(name); toggleSidebar(); };
        list.appendChild(div);
    });
}

function deleteMap(name, e) { e.stopPropagation(); if(confirm("Excluir?")) { delete maps[name]; localStorage.setItem(DB_KEY, JSON.stringify(maps)); renderMapList(); } }
function clearAllData() { if(confirm("Resetar TUDO?")) { localStorage.clear(); location.reload(); } }
function exportData() { const blob = new Blob([JSON.stringify(maps)], {type:"application/json"}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = "stellar_backup.json"; a.click(); }
function importData(e) { const reader = new FileReader(); reader.onload = (ev) => { maps = JSON.parse(ev.target.result); localStorage.setItem(DB_KEY, JSON.stringify(maps)); location.reload(); }; reader.readAsText(e.target.files[0]); }

function draw() {
    ctx.fillStyle = getComputedStyle(document.body).getPropertyValue('--space-black');
    ctx.fillRect(0, 0, window.innerWidth, window.innerHeight);
    
    if(currentTheme === 'grid') {
        ctx.strokeStyle = `rgba(255, 159, 67, ${gridOpacity})`;
        let step = 60 * camera.zoom;
        for(let x = (camera.x * camera.zoom) % step; x < window.innerWidth; x += step) {
            ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, window.innerHeight); ctx.stroke();
        }
        for(let y = (camera.y * camera.zoom) % step; y < window.innerHeight; y += step) {
            ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(window.innerWidth, y); ctx.stroke();
        }
    }

    ctx.save();
    ctx.translate(window.innerWidth/2 + camera.x * camera.zoom, window.innerHeight/2 + camera.y * camera.zoom);
    ctx.scale(camera.zoom, camera.zoom);

    if (points.length > 1) {
        ctx.beginPath(); ctx.strokeStyle = "rgba(0, 242, 255, 0.2)";
        ctx.moveTo(points[0].x, points[0].y);
        points.forEach(p => ctx.lineTo(p.x, p.y)); ctx.stroke();
    }

    points.forEach(p => {
        ctx.fillStyle = "#fff"; ctx.beginPath(); ctx.arc(p.x, p.y, 4, 0, Math.PI*2); ctx.fill();
        ctx.font = "10px Arial"; ctx.fillStyle = varColor('--star-cyan');
        ctx.fillText(p.label, p.x + 8, p.y + 3);
    });

    ctx.restore();
    requestAnimationFrame(draw);
}
function varColor(n) { return getComputedStyle(document.body).getPropertyValue(n); }

// Eventos de Toque e Zoom
canvas.addEventListener('touchstart', e => {
    if (e.touches.length === 1) { isDragging = true; lastTouchPos = { x: e.touches[0].clientX, y: e.touches[0].clientY }; }
    else if (e.touches.length === 2) { isDragging = false; initialPinchDist = Math.hypot(e.touches[0].clientX - e.touches[1].clientX, e.touches[0].clientY - e.touches[1].clientY); initialZoom = camera.zoom; }
});
canvas.addEventListener('touchmove', e => {
    if (e.touches.length === 1 && isDragging) {
        camera.x += (e.touches[0].clientX - lastTouchPos.x) / camera.zoom;
        camera.y += (e.touches[0].clientY - lastTouchPos.y) / camera.zoom;
        lastTouchPos = { x: e.touches[0].clientX, y: e.touches[0].clientY };
    } else if (e.touches.length === 2) {
        const dist = Math.hypot(e.touches[0].clientX - e.touches[1].clientX, e.touches[0].clientY - e.touches[1].clientY);
        camera.zoom = Math.min(Math.max(initialZoom * (dist / initialPinchDist), 0.2), 5);
    }
});
canvas.addEventListener('touchend', () => isDragging = false);

setupCanvas();
renderMapList();
draw();
</script>
</body>
</html>
